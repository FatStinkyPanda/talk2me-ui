# .pre-commit-config.yaml
# Comprehensive code quality enforcement for AI-assisted development
# Install: pre-commit install && pre-commit install --hook-type commit-msg

default_language_version:
  python: python3.10

default_stages: [pre-commit, pre-push]

repos:
  #=============================================================================
  # GENERAL CHECKS
  #=============================================================================
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      # File quality
      - id: trailing-whitespace
        name: "ğŸ§¹ Remove trailing whitespace"
      - id: end-of-file-fixer
        name: "ğŸ“„ Fix end of file"
      - id: mixed-line-ending
        name: "ğŸ“ Fix mixed line endings"
        args: ["--fix=lf"]

      # Syntax validation
      - id: check-yaml
        name: "âœ… Validate YAML"
        args: ["--unsafe"]
      - id: check-json
        name: "âœ… Validate JSON"
      - id: check-toml
        name: "âœ… Validate TOML"
      - id: check-xml
        name: "âœ… Validate XML"

      # Code safety
      - id: check-ast
        name: "ğŸ Check Python AST"
      - id: check-docstring-first
        name: "ğŸ“š Check docstring placement"
      - id: debug-statements
        name: "ğŸ› Check for debug statements"
      - id: check-builtin-literals
        name: "ğŸ”¤ Check builtin literals"

      # Security
      - id: detect-private-key
        name: "ğŸ” Detect private keys"
      - id: check-added-large-files
        name: "ğŸ“¦ Check for large files"
        args: ["--maxkb=1000"]

      # Git
      - id: check-merge-conflict
        name: "âš”ï¸ Check merge conflicts"
      - id: no-commit-to-branch
        name: "ğŸ›¡ï¸ Protect master branch"
        args: ["--branch", "master"]

      # Executables
      - id: check-executables-have-shebangs
        name: "ğŸ“œ Check shebangs"
      - id: check-shebang-scripts-are-executable
        name: "ğŸ”§ Check executable scripts"

  #=============================================================================
  # SECRET DETECTION
  #=============================================================================
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.5.0
    hooks:
      - id: detect-secrets
        name: "ğŸ”’ Detect secrets"
        args: ["--baseline", ".secrets.baseline"]
        exclude: package-lock\.json|\.secrets\.baseline

  #=============================================================================
  # PYTHON - RUFF (Linting + Formatting)
  #=============================================================================
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.14.8
    hooks:
      - id: ruff
        name: "ğŸ Ruff linter"
        args: ["--fix", "--exit-non-zero-on-fix"]
      - id: ruff-format
        name: "ğŸ¨ Ruff formatter"

  #=============================================================================
  # PYTHON - TYPE CHECKING
  #=============================================================================
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.19.0
    hooks:
      - id: mypy
        name: "ğŸ” MyPy type checker"
        additional_dependencies:
          - types-requests
          - types-PyYAML
        args: ["--ignore-missing-imports", "--no-strict-optional"]

  #=============================================================================
  # PYTHON - SECURITY
  #=============================================================================
  - repo: https://github.com/PyCQA/bandit
    rev: 1.9.2
    hooks:
      - id: bandit
        name: "ğŸ›¡ï¸ Bandit security check"
        args: ["-c", "pyproject.toml", "-r", "-ll"]
        additional_dependencies: ["bandit[toml]"]

  #=============================================================================
  # PYTHON - DOCSTRINGS
  #=============================================================================
  - repo: https://github.com/pycqa/pydocstyle
    rev: 6.3.0
    hooks:
      - id: pydocstyle
        name: "ğŸ“– Pydocstyle docstring check"
        args: ["--convention=google", "--add-ignore=D100,D104,D105,D107"]

  #=============================================================================
  # PYTHON - COMPLEXITY
  #=============================================================================
  - repo: https://github.com/rubik/xenon
    rev: v0.9.3
    hooks:
      - id: xenon
        name: "ğŸ“Š Xenon complexity check"
        args:
          ["--max-absolute", "B", "--max-modules", "B", "--max-average", "A"]

  #=============================================================================
  # JAVASCRIPT / TYPESCRIPT
  #=============================================================================
  - repo: https://github.com/pre-commit/mirrors-eslint
    rev: v10.0.0-alpha.1
    hooks:
      - id: eslint
        name: "ğŸ“¦ ESLint"
        files: \.[jt]sx?$
        types: [file]
        additional_dependencies:
          - eslint@8.56.0
          - eslint-config-prettier@9.1.0
          - eslint-plugin-import@2.29.1
          - eslint-plugin-prettier@5.1.3
          - "@typescript-eslint/eslint-plugin@7.1.0"
          - "@typescript-eslint/parser@7.1.0"
          - typescript@5.3.3

  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v4.0.0-alpha.8
    hooks:
      - id: prettier
        name: "âœ¨ Prettier"
        types_or: [javascript, jsx, ts, tsx, json, yaml, markdown, css, scss]

  #=============================================================================
  # SHELL SCRIPTS
  #=============================================================================
  - repo: https://github.com/shellcheck-py/shellcheck-py
    rev: v0.11.0.1
    hooks:
      - id: shellcheck
        name: "ğŸš ShellCheck"
        args: ["--severity=warning"]

  - repo: https://github.com/scop/pre-commit-shfmt
    rev: v3.12.0-2
    hooks:
      - id: shfmt
        name: "ğŸ”§ Shell formatter"
        args: ["-i", "2", "-ci", "-bn"]

  #=============================================================================
  # MARKDOWN
  #=============================================================================
  - repo: https://github.com/igorshubovych/markdownlint-cli
    rev: v0.46.0
    hooks:
      - id: markdownlint
        name: "ğŸ“ Markdown lint"
        args: ["--fix", "--disable", "MD013", "MD033", "MD041"]

  #=============================================================================
  # DOCKER
  #=============================================================================
  - repo: https://github.com/hadolint/hadolint
    rev: v2.14.0
    hooks:
      - id: hadolint-docker
        name: "ğŸ³ Dockerfile lint"

  #=============================================================================
  # SQL
  #=============================================================================
  - repo: https://github.com/sqlfluff/sqlfluff
    rev: 4.0.0a2
    hooks:
      - id: sqlfluff-lint
        name: "ğŸ—ƒï¸ SQL lint"
        args: ["--dialect", "postgres"]
      - id: sqlfluff-fix
        name: "ğŸ”§ SQL fix"
        args: ["--dialect", "postgres"]

  #=============================================================================
  # COMMIT MESSAGE
  #=============================================================================
  - repo: https://github.com/commitizen-tools/commitizen
    rev: v4.10.0
    hooks:
      - id: commitizen
        name: "ğŸ“ Conventional commit check"
        stages: [commit-msg]

  #=============================================================================
  # CUSTOM HOOKS - MEMORY ENFORCEMENT
  #=============================================================================
  - repo: local
    hooks:
      - id: memory-sync-check
        name: "ğŸ§  Memory sync check"
        entry: .git/hooks/check-memory-sync.sh
        language: script
        stages: [pre-commit]
        always_run: true
        pass_filenames: false
        description: "Ensures OpenMemory is updated for significant changes"

      - id: run-tests
        name: "ğŸ§ª Run tests"
        entry: .git/hooks/run-tests.sh
        language: script
        stages: [pre-commit]
        pass_filenames: false
        types: [python]
        description: "Run pytest for Python changes"

      - id: check-todo-fixme
        name: "ğŸ“‹ Check TODO/FIXME"
        entry: .git/hooks/check-todos.sh
        language: script
        stages: [pre-commit]
        pass_filenames: false
        description: "Warn about TODO/FIXME comments"

# Configuration for specific file types
files: ""
exclude: |
  (?x)^(
    \.git/|
    \.mypy_cache/|
    \.pytest_cache/|
    \.ruff_cache/|
    __pycache__/|
    node_modules/|
    \.venv/|
    venv/|
    dist/|
    build/|
    \.eggs/|
    .*\.egg-info/|
    \.tox/
  )
